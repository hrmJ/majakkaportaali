# Majakkaportaali

Projektin tarkoitus tehdä seurakuntavastuiden jakamisesta ja viestinnästä helpompaa. 

# Asennus LXC-konttiin

Kloonaa ensin majakkaportaali-repositorio sopivaan sijaintiin host-koneella.
(esimerkiksi `~/projects/majakkaportaali`).

(`git clone https://github.com/hrmJ/majakkaportaali.git`).

## Kontin luominen

Ohjeet olettavat, että käytössä on [lxc-kontteja](https://linuxcontainers.org/).
tukeva linux-distro. Oletusympäristö kehitystyöhön itse kontissa on ubuntu 18.04.

1.  Luo ubuntu 18.04 -kontti: `sudo lxc-create -t download -n majakkaportaali`

    -   Vastaa kysymyksiin distrosta, versiosta and arkkitehtuurista: ubuntu, bionic, amd64

2.  Käynnistä kontti: `sudo lxc-start -n majakkaportaali`. 
    Kirjaudu sisään: `sudo lxc-attach -n majakkaportaali`.

3.  Luo kontissa kansio projektia varten, esim. `mkdir /opt/majakkaportaali`

4.  Kirjaudu ulos (aja isäntäkoneella `sudo lxc-stop -n majakkaportaali`)

5.  Kehitystyön helpottamiseksi mounttaa projektikansio konttiin. Aja
    isäntäkoneella:


    sudo echo 'lxc.mount.entry = {KOKO POLKU majakkaportaali-kansioon} /var/lib/lxc/nexthammer/rootfs/opt/nexthammer/  none bind 0 0' >> /var/lib/lxc/nexthammer/config

Esimerkiksi siis:

    sudo echo 'lxc.mount.entry = /home/user/projects/majakkaportaali /var/lib/lxc/nexthammer/rootfs/opt/nexthammer/  none bind 0 0' >> /var/lib/lxc/nexthammer/config

Starttaa sitten kontti uudestaan ja kirjaudu uudestaan sisään:

    sudo lxc-start -n majakkaportaali
    sudo lxc-attach -n majakkaportaali

## Portaalin asennus kontissa

Kun kontti on luotu, siirry `/opt/majakkaportaali/install_scripts`-kansioon.
Aja siellä skriptit seuraavassa järjestyksessä

    cd install_scripts/
    sh install_dependencies.sh
    sh setup_mysql.sh
    sh setup_server.sh

Vaihda pois root-käyttäjästä (luo uusi käyttäjä, jos tarvitsee) ja aja vielä

    sh setup_composer.sh

## Portaaliin pääsy isäntäkoneelta

1.  Ota  talteen kontin ip-osoite ajamalla `sudo lxc-info -n majakkaportaali`
2.  Muokkaa `/etc/hosts` -tiedostoa tunnistamaan tämä ip (esim `sudo vim /etc/hosts`) lisäämällä
    rivi: `{IP-OSOITE} majakkaportaali.test`.

Nyt majakkaportaalin pitäisi näkyä, kun menet isäntäkoneella osoitteeksi esimerkiksi
`majakkaportaali.test/service?id=2`

Jos sivua ei näy, tsekkaa nginx-logi (`/var/log/nginx/majakkaportaali.test-error.log`)


# Satunnaisia huomioita

Diaesityksissä: poista esim. firefoxissa olevat sylesheettejä muokkaavat pluginit (kuten tridactyl, vimperator tms) käytöstä!


# Ohjeita kehittäjille

## JS-dokumentaatio

- Asenna (sudo-valtuuksin) [documentation.js](https://github.com/documentationjs/documentation) node-moduulina: `npm install -g documentation`
- Päivitä dokumentaatio ajamalla projektin juuressa `documentation readme src/js/site/** --section "Javascript API"
`

## Muuta

Vanhan template-placeholderen korvaamiseen käytettävä regex vimissä:   %s/\[@\(\w\+\)\]/{{{\1}}}/gc

# Javascript API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [Comments](#comments)
-   [ExpandCommentField](#expandcommentfield)
-   [LoadComments](#loadcomments)
-   [SaveComment](#savecomment)
-   [CreateCommentAnswerField](#createcommentanswerfield)
-   [CreateThemeSelect](#createthemeselect)
-   [Details](#details)
    -   [GetTheme](#gettheme)
        -   [Parameters](#parameters)
    -   [SetTheme](#settheme)
        -   [Parameters](#parameters-1)
    -   [GetTabData](#gettabdata)
-   [Infoslides](#infoslides)
    -   [SaveTabData](#savetabdata)
-   [People](#people)
    -   [SetResponsibles](#setresponsibles)
        -   [Parameters](#parameters-2)
    -   [GetResponsibles](#getresponsibles)
        -   [Parameters](#parameters-3)
    -   [GetTabData](#gettabdata-1)
-   [Songs](#songs)
    -   [SaveTabData](#savetabdata-1)
    -   [GetTabData](#gettabdata-2)
-   [Structure](#structure)
    -   [SetStructure](#setstructure)
        -   [Parameters](#parameters-4)
    -   [GetStructure](#getstructure)
        -   [Parameters](#parameters-5)
    -   [SaveTabData](#savetabdata-2)
    -   [GetTabData](#gettabdata-3)
-   [Service](#service)
-   [TabFactory](#tabfactory)
    -   [AddSaveButton](#addsavebutton)
    -   [SaveTabData](#savetabdata-3)
    -   [MonitorChanges](#monitorchanges)
    -   [AfterSavedChanges](#aftersavedchanges)
        -   [Parameters](#parameters-6)
    -   [make](#make)
        -   [Parameters](#parameters-7)
-   [GetServiceId](#getserviceid)
-   [Initialize](#initialize)
-   [Initialize](#initialize-1)
-   [Initialize](#initialize-2)
-   [Servicelist](#servicelist)
-   [List](#list)
    -   [LoadServices](#loadservices)
        -   [Parameters](#parameters-8)
    -   [Output](#output)
        -   [Parameters](#parameters-9)
-   [MonthName](#monthname)
    -   [Parameters](#parameters-10)
-   [SongSlots](#songslots)
-   [LoadSongTitles](#loadsongtitles)
    -   [Parameters](#parameters-11)
-   [LoadSongsToSlots](#loadsongstoslots)
    -   [Parameters](#parameters-12)
-   [SaveSlotOrder](#saveslotorder)
    -   [Parameters](#parameters-13)
-   [SaveSlotOrder](#saveslotorder-1)
    -   [Parameters](#parameters-14)
-   [InitializeContainers](#initializecontainers)
    -   [Parameters](#parameters-15)
-   [SlotContainer](#slotcontainer)
    -   [Parameters](#parameters-16)
    -   [SetName](#setname)
        -   [Parameters](#parameters-17)
    -   [FetchSlots](#fetchslots)
    -   [SetSlots](#setslots)
        -   [Parameters](#parameters-18)
    -   [AddSortability](#addsortability)
    -   [SetMultisongButtons](#setmultisongbuttons)
    -   [AddNewSlot](#addnewslot)
    -   [RemoveSlot](#removeslot)
-   [SongSlot](#songslot)
    -   [Parameters](#parameters-19)
    -   [Create](#create)
    -   [Remove](#remove)
    -   [AttachSong](#attachsong)
        -   [Parameters](#parameters-20)
    -   [CheckLyrics](#checklyrics)
        -   [Parameters](#parameters-21)
    -   [IndicateLyrics](#indicatelyrics)
        -   [Parameters](#parameters-22)
    -   [AttachEvents](#attachevents)
-   [SongLists](#songlists)
-   [Songlist](#songlist)
    -   [GetAndSetSubCategories](#getandsetsubcategories)
    -   [SetSubCategories](#setsubcategories)
        -   [Parameters](#parameters-23)
    -   [SetSongs](#setsongs)
        -   [Parameters](#parameters-24)
    -   [PrepareSongForInsertion](#preparesongforinsertion)
        -   [Parameters](#parameters-25)
-   [AlphabeticalSonglist](#alphabeticalsonglist)
    -   [ListSongs](#listsongs)
        -   [Parameters](#parameters-26)
-   [LoadSongLists](#loadsonglists)
-   [GetWaitingForAttachment](#getwaitingforattachment)
-   [widget](#widget)
-   [Menus](#menus)
-   [Covermenu](#covermenu)
    -   [OpenMenu](#openmenu)
        -   [Parameters](#parameters-27)
    -   [Initialize](#initialize-3)
-   [bibleslide](#bibleslide)
-   [infoslide](#infoslide)
    -   [FillInData](#fillindata)
        -   [Parameters](#parameters-28)
    -   [SetSlideParams](#setslideparams)
-   [songslide](#songslide)
    -   [FillInData](#fillindata-1)
        -   [Parameters](#parameters-29)
    -   [SetSlideParams](#setslideparams-1)
    -   [AddAutoComplete](#addautocomplete)
-   [GeneralStructure](#generalstructure)
    -   [SelectTheContentToAdd](#selectthecontenttoadd)
        -   [Parameters](#parameters-30)
    -   [Initialize](#initialize-4)
-   [GeneralStructure](#generalstructure-1)
    -   [SelectTheContentToAdd](#selectthecontenttoadd-1)
        -   [Parameters](#parameters-31)
    -   [Initialize](#initialize-5)
-   [GeneralStructure](#generalstructure-2)
    -   [SelectTheContentToAdd](#selectthecontenttoadd-2)
        -   [Parameters](#parameters-32)
    -   [Initialize](#initialize-6)
-   [Attach](#attach)
    -   [Parameters](#parameters-33)
-   [Attach](#attach-1)
    -   [Parameters](#parameters-34)
-   [Attach](#attach-2)
    -   [Parameters](#parameters-35)
-   [Attach](#attach-3)
    -   [Parameters](#parameters-36)
-   [Attach](#attach-4)
    -   [Parameters](#parameters-37)
-   [Attach](#attach-5)
    -   [Parameters](#parameters-38)
-   [LoadParams](#loadparams)
-   [SaveParams](#saveparams)
    -   [Parameters](#parameters-39)
-   [SetSlotParams](#setslotparams)
-   [UpdateSlot](#updateslot)
    -   [Parameters](#parameters-40)
-   [AddNewSlot](#addnewslot-1)
    -   [Parameters](#parameters-41)
-   [GetSlideClass](#getslideclass)
-   [SetPreviewParams](#setpreviewparams)
-   [GetSlideClasses](#getslideclasses)
-   [SetSlideClasses](#setslideclasses)
    -   [Parameters](#parameters-42)
-   [UpdatePickedHeader](#updatepickedheader)
-   [SetHeaderTemplates](#setheadertemplates)
    -   [Parameters](#parameters-43)
-   [PickHeader](#pickheader)
    -   [Parameters](#parameters-44)
-   [AddImageLoader](#addimageloader)
-   [CreateListOfImages](#createlistofimages)
    -   [Parameters](#parameters-45)
-   [InitializeInjectableData](#initializeinjectabledata)
-   [InsertInjectableData](#insertinjectabledata)
    -   [Parameters](#parameters-46)
-   [ShowWindow](#showwindow)
-   [SetLightBox](#setlightbox)
    -   [Parameters](#parameters-47)
-   [CloseLightBox](#closelightbox)
-   [SetPreviewWindow](#setpreviewwindow)
    -   [Parameters](#parameters-48)
-   [PreviewSlide](#previewslide)
-   [SetPreviewContent](#setpreviewcontent)
-   [SortableList](#sortablelist)
    -   [Parameters](#parameters-49)
    -   [Initialize](#initialize-7)
        -   [Parameters](#parameters-50)
    -   [RefreshPseudoSlots](#refreshpseudoslots)
    -   [AddDroppables](#adddroppables)
    -   [DragStart](#dragstart)
        -   [Parameters](#parameters-51)
    -   [CleanUp](#cleanup)
        -   [Parameters](#parameters-52)
    -   [DragLeave](#dragleave)
        -   [Parameters](#parameters-53)
    -   [DragOver](#dragover)
        -   [Parameters](#parameters-54)
    -   [Drop](#drop)
        -   [Parameters](#parameters-55)
-   [ReloadSlots](#reloadslots)
    -   [Parameters](#parameters-56)
-   [RemoveSlot](#removeslot-1)
-   [InitializeNewslotMenu](#initializenewslotmenu)
-   [InitializeSlotFunctionality](#initializeslotfunctionality)
-   [UpdateAdderEvents](#updateadderevents)
-   [SlotFactory](#slotfactory)
    -   [make](#make-1)
        -   [Parameters](#parameters-57)
-   [loaderpath](#loaderpath)
-   [loaderpath](#loaderpath-1)
-   [AddMultisongsRow](#addmultisongsrow)
-   [CheckIfLyricsExist](#checkiflyricsexist)
    -   [Parameters](#parameters-58)
-   [LoadLyricsByTitle](#loadlyricsbytitle)
    -   [Parameters](#parameters-59)
-   [ShowLyricsWindow](#showlyricswindow)
-   [EditLyrics](#editlyrics)
-   [AddLyrics](#addlyrics)
    -   [Parameters](#parameters-60)
-   [SaveLyrics](#savelyrics)
-   [CloseWordEdit](#closewordedit)
-   [SongListView](#songlistview)
-   [ready](#ready)
-   [ScrollToCenter](#scrolltocenter)
    -   [Parameters](#parameters-61)
-   [BlurContent](#blurcontent)
-   [extend](#extend)
    -   [Parameters](#parameters-62)
-   [Preview](#preview)
    -   [Parameters](#parameters-63)
-   [Message](#message)
    -   [Parameters](#parameters-64)
    -   [Show](#show)
        -   [Parameters](#parameters-65)

## Comments

Kommentit - lataaminen ja prosessointi

## ExpandCommentField

Laajenna näkyviin uuden kommentin kirjoituskenttä

## LoadComments

Lataa kaikki kommentit tietokannasta dokumenttiin
Lataa myös uuden kommentin syöttämiseen tarvittavat tiedot.

## SaveComment

Tallenna syötetty kommentti

## CreateCommentAnswerField

Syötä tekstikenttä kommenttiin tai viestiketjuun
vastaamista varten.

## CreateThemeSelect

Luo select-elementin, jossa kommentin aiheen voi valita

\*

## Details

Messun tiedot -välilehti. Yksittäisen messun aihe, raamatunkohdat
ja muu yleisen tason (ei ihmisiä koskeva )info, tämän muokkaus ym.

\*

### GetTheme

Hakee messun teeman

#### Parameters

-   `callback`  funktio, joka ajetaan kun lataus on valmis\*

### SetTheme

Vaihtaa messun teeman

#### Parameters

-   `theme`  uusi teema, joka messulle asetetaan\*

### GetTabData

Kerää kaiken välilehden sisältämän datan joko tallentamista
varten tai jotta voitaisiin nähdä, onko tehty muutoksia.

\*

## Infoslides

Messun infodiat

\*

### SaveTabData

\*

## People

Messun vastuunkantajat. (Vastuunkantajat-välilehti)

\*

### SetResponsibles

Tulostaa kaikkien messussa mukana olevien vastuunkantajien nimet

#### Parameters

-   `list_of_people`  ajax-responssina saatu taulukko muodossa [{responsible:x,responsibility:x},{:},...]\*

### GetResponsibles

Hakee messun vastuunkantajat

#### Parameters

-   `callback`  funktio, joka ajetaan kun lataus on valmis\*

### GetTabData

Kerää kaiken välilehden sisältämän datan joko tallentamista
varten tai jotta voitaisiin nähdä, onko tehty muutoksia.

\*

## Songs

Lauluvälilehti ja sen toiminnallisuus (huom, lauluslotit ja laululistat omia luokkiaan)

\*

### SaveTabData

\*

### GetTabData

Kerää kaiken välilehden sisältämän datan joko tallentamista
varten tai jotta voitaisiin nähdä, onko tehty muutoksia.

\*

## Structure

Messun rakenteen säätely

\*

### SetStructure

Syöttää tietokannasta haetun rakennedatan html:ään

\*

#### Parameters

-   `html`  

### GetStructure

Hakee messu-spesifin rakenteen (laulut, osiot, yms) tietokannasta

#### Parameters

-   `callback`  
-   `callaback`  ajax-vastauksen käsittelevä funktio\*

### SaveTabData

\*

### GetTabData

Kerää kaiken välilehden sisältämän datan joko tallentamista
varten tai jotta voitaisiin nähdä, onko tehty muutoksia.

\*

## Service

Yksittäisen messun / palveluksen toiminnot

\*

## TabFactory

Factory-pattern eri välilehtiä edustavien olioiden luomiseksi

\*

### AddSaveButton

Lisää tallenna-painikkeet kunkin täbin alareunaan

\*

### SaveTabData

Tallentaa välilehdessä tehdyt muutokset 

\*

### MonitorChanges

Tarkastelee muutoksia ja ilmoittaa käyttäjälle, jos tallentamattomia
muutoksia havaitaan

\*

### AfterSavedChanges

Lisää tallenna-painikkeet kunkin täbin alareunaan

#### Parameters

-   `response`  ajax-vastaus\*

### make

Tuottaa yhden välilehtiolion haluttua tyyppiä

#### Parameters

-   `$div`  
-   `$tab`  jquery-esitys yhdestä välilehti-divistä\*

## GetServiceId

Palauttaa tämänhetkisen messun id:n

\*

## Initialize

Alusta messunäkymän sisältö, tapahtumat ym.

\*

## Initialize

Alusta messunäkymän sisältö, tapahtumat ym.

\*

## Initialize

Alusta kaikki messun rakenneosiin liittyvät tapahtumat

\*

## Servicelist

Yksittäisen messun / palveluksen toiminnot

\*

## List

Lista kaikista yhden tietyn kauden messuista

\*

### LoadServices

Lataa messulista

#### Parameters

-   `callback`  funktio, joka ajetaan kun lataus on valmis\*

### Output

Tulostaa listan ja liittää sen osaksi html-DOMia

#### Parameters

-   `data`  listaan syötettävät tiedot\*

## MonthName

Muuttaa kuukauden numeron nimeksi

### Parameters

-   `month_no`  kuukauden numero\*

## SongSlots

Moduuli yhden messun laulusloteista

\*

## LoadSongTitles

Hakee tietokannassa olevien laulujen nimet

\*

### Parameters

-   `request`  
-   `response`  

## LoadSongsToSlots

Hakee nyt käsiteltävässä messussa käytössä olevat laulut

### Parameters

-   `songtab`  Laulut-välilehti omana olionaan\*

## SaveSlotOrder

Tallentaa muutokset lauluslottien järjestykseen yhden "kontin" sisällä 

\*

### Parameters

-   `$parent_el`  

## SaveSlotOrder

Tallentaa muutokset slottien järjestykseen

### Parameters

-   `$ul`  listan jquery-representaatio\*

## InitializeContainers

Luo jokaisesta lauluslotista oma olionsa, joka kuuntelee siihen
liittyviä tapahtumia, kuten laulujen raahaamista.

### Parameters

-   `slot_data`  ajax-response, joka sisältää tiedot tähän messuun tallennetuista lauluista\*

## SlotContainer

Yhden tai useamman laulun sisältävä slotti
tai pikemminkin niiden  "kontti"

### Parameters

-   `$div`  kontti representaatio DOMissa\*

### SetName

Asettaa nimen

#### Parameters

-   `name`  asetettava nimi

### FetchSlots

Hakee käikki tämän kontin sisältämät laulut

\*

### SetSlots

Syöttää kontin sisältämien lauluslottien mukaisen datan paikalleen

#### Parameters

-   `slots`  taulukko niistä sloteista, joita ajax-response palauttaa\*

### AddSortability

Lisää järjestelymahdollisuuden konttiin, jossa monta lauluslottia

\*

### SetMultisongButtons

Lisää painikkeet, joilla voidaan lisätä tai vähentää lauluja tästä
"kontista"

\*

### AddNewSlot

Lisää tämän kontin alle uuden slotin

\*

### RemoveSlot

Poistaa tämän kontin alta slotin

## SongSlot

Yksi lauluslotti, joka kuvaa esim. alkulaulua tai yhtä
ylistyslauluista

### Parameters

-   `title`  valitun laulun nimi (jos joku laulu jo valittu)
-   `position`  valitun laulun järjestysnumero tässä "kontissa"
-   `$cont`  slotin sisältävä "kontti" DOMissa\*

### Create

Lisää DOMiin divin, jossa varsinainen slotti on kuvattuna

\*

### Remove

Poistaa tämän laulun kontista

\*

### AttachSong

Liittää tähän slottiin jonkin laulun esimerkiksi sen jälkeen, kun
käyttäjä on raahannnut laululistan selauksen jälkeen näytölle
jääneen laulun slotin päälle.

#### Parameters

-   `drop_event`  mahdollinen pudotustapahtuma, joka kuuluu lauluslotti-diviin\*

### CheckLyrics

Tarkistaa, onko tämän laulun sanoja tietokannassa

\*

#### Parameters

-   `ev`  
-   `item`  

### IndicateLyrics

Näyttää informaation siitä, onko laulun sanoja tietokannassa. Lisää
myös tiedon niistä laulujen id:istä, jotka valitulla laulun nimellä
löytyvät.

TODO: mahdollisuus klikata yksityiskohtaikkunasta vahvistus sille,
että tähän ei tule sanoja.

#### Parameters

-   `song_ids`  id:t niistä lauluista, joita löydettiin\*

### AttachEvents

Liittää lauluslottiin kuuluvat tapahtumat

\*

## SongLists

Moduuli erilaisille laulujen selauslistoille

\*

## Songlist

Lista, josta käyttäjä näkee kaikki selattavissa olevat laulut

\*

### GetAndSetSubCategories

Hakee alaluokat tietokannasta

\*

### SetSubCategories

Lisää alaluokat listaan

\*

#### Parameters

-   `categories`  
-   `self`  

### SetSongs

Listaa kaikki tämän kategorian / kirjaimen laulut, jotka
on jo haettu tietokannasta

#### Parameters

-   `songs`  laulujen nimet taulukkona
-   `$launcher`  tapahtuman laukaissut listaelementti
-   `self`  viittaus olioon itseensä\*

### PrepareSongForInsertion

Erottaa listasta valitun laulun, niin että se voidaan
liittää osaksi messua.

#### Parameters

-   `$launcher`  tapahtuman laukaissut laulu\*

## AlphabeticalSonglist

Aakkosittain järjestetty lista

\*

### ListSongs

Hakee kaikki käyttäjän klikkaamaan kategoriaan
kuuluvat laulut ja listaa ne

#### Parameters

-   `$launcher`  klikkauksen laukaissut linkki\*

## LoadSongLists

Lataa kaikki selattavat kategoriat (eri listat)

\*

## GetWaitingForAttachment

Hae liittämistä odottavan laulun nimi

\*

## widget

Jquery ui:n selectmenu-pluginin muokkaus niin, että
mahdollista valita myös tekstikenttä.

## Menus

Moduuli erilaisille menuille

\*

## Covermenu

Yksinkertainen, koko ruudun peittävä menu

\*

### OpenMenu

Avaa oikean menun, kun klikattu oikeaa linkkiä

#### Parameters

-   `$launcher`  menu-klikkauksen laukaissut linkki\*

### Initialize

Alustaa itse menujen toiminnallisuuden:
sulkulinkki ym.

\*

## bibleslide

Yksittäisen diasisällön lisäävä olio.

## infoslide

Yksittäisen diasisällön lisäävä olio.

### FillInData

Lisää ajax-ladatun datan slottiin

#### Parameters

-   `data`  dian tiedot ajax-responssina \*

### SetSlideParams

Kerää diaan liittyvän informaation tallentamista tai esikatselua
varten

\*

## songslide

Laulusisällön lisäävä olio.

### FillInData

Lisää ajax-ladatun datan slottiin

#### Parameters

-   `data`  dian tiedot ajax-responssina \*

### SetSlideParams

Kerää diaan liittyvän informaation tallentamista tai esikatselua
varten

\*

### AddAutoComplete

Aseta autocomplete-mahdollisuus etsiä lauluja rajoitettuun listaan
Käytetään hyväksi jquery ui:n skriptiä useista autocomplete-arvoista
(<https://jqueryui.com/autocomplete/#multiple>)

## GeneralStructure

Moduuli, jolla hallitaan messujen rakennetta: lauluja, raamatunkohtia, 
messukohtaisia tai yleisempiä infodioja jne.

\*

### SelectTheContentToAdd

Valitse, mitä sisältöä ryhdytään lisäämään. 
Valintamenun  (jqueryui menu) callback.

#### Parameters

-   `e`  
-   `u`  

### Initialize

Pohjusta messun rakenteen muokkaus ja siihen liittyvät tapahtumat

\*

## GeneralStructure

Tapahtumat, jotka liittyvät messurakenteen määrittelyyn

### SelectTheContentToAdd

Valitse, mitä sisältöä ryhdytään lisäämään. 
Valintamenun  (jqueryui menu) callback.

#### Parameters

-   `e`  
-   `u`  

### Initialize

Pohjusta messun rakenteen muokkaus ja siihen liittyvät tapahtumat

\*

## GeneralStructure

Alempi namespace: messun rakenteen muokkaamiseen liittyvät tapahtumat

\*

### SelectTheContentToAdd

Valitse, mitä sisältöä ryhdytään lisäämään. 
Valintamenun  (jqueryui menu) callback.

#### Parameters

-   `e`  
-   `u`  

### Initialize

Pohjusta messun rakenteen muokkaus ja siihen liittyvät tapahtumat

\*

## Attach

Liittää datan lataamiseen  liittyvän toiminnallisuuden lähdeolioon

### Parameters

-   `source`  olio, johon liitetään\*

## Attach

Liittää ylätunnisteisiin liittyvän toiminnallisuuden lähdeolioon

### Parameters

-   `source`  olio, johon liitetään\*

## Attach

Liittää kuvien lataamiseen  liittyvän toiminnallisuuden lähdeolioon

### Parameters

-   `source`  olio, johon liitetään\*

## Attach

Liittää datan upottamiseen  liittyvän toiminnallisuuden lähdeolioon

### Parameters

-   `source`  olio, johon liitetään\*

## Attach

Liittää messurakenteen lightbox-ikkunaan liittyvän toiminnallisuuden
lähdeolioon

### Parameters

-   `source`  olio, johon liitetään\*

## Attach

Liittää messurakenteen lightbox-ikkunaan liittyvän toiminnallisuuden
lähdeolioon

### Parameters

-   `source`  olio, johon liitetään\*

## LoadParams

Hae dian sisältötiedot tietokannasta: tyypistä riippuen vähintään nimi ja luokka,
mahdollisesti myös teksti, laulun nimi, kuvat, ylätunniste jne.

## SaveParams

Tallentaa diaaan tehdyt muutokset

### Parameters

-   `callback`  , funktio,joka laukaistaan, kun tallennus valmis

## SetSlotParams

Hakee yleiset, tätä slottia koskevat tiedot ja tallentaa ne
slot_params-attribuuttiin

## UpdateSlot

Päivittää tietokantaan käyttäjän muuttamat slottikohtaiset tiedot

### Parameters

-   `callback`  funktio, joka suoritetaan, kun valmis

## AddNewSlot

Lisää kokonaan uuden slotin tietokantaan: jos esimerkiksi käyttäjä
lisää slotin "alkuinfo", tämä lisätään presentation_structure-tauluun samalla
kun dian konkreettinen lisätään infosegments-tauluun

### Parameters

-   `callback`  funktio, joka suoritetaan, kun valmis

## GetSlideClass

Hakee luokan, jos asetetu

## SetPreviewParams

Tallenna dian tiedot tietokantaan (myös mahdollista esikatselua varten)

## GetSlideClasses

Lataa käytössä olevta messuosiot / dialuokat tietokannasta

## SetSlideClasses

Syötä käytössä olevta messuosiot / dialuokat select-valikkoon

### Parameters

-   `data`  ajax-responssina saatu data eli lista käytössä olevista luokista

## UpdatePickedHeader

Päivitä tietokantaan ylätunnisteeseen tehdyt muutokset, kuten
kuvan vaihtaminen tai kuvan sijainnin muuttaminen

## SetHeaderTemplates

Tulostaa käyttäjän määrittämät ylätunnisteet.
Tallentaa myös muistiin ylätunnisteiden sisällön.
Huomaa, että tämä metodi kutsutaan AddImageLoader-metodista,
jotta ylätunnisteen kuvat ehtivät latautua.

### Parameters

-   `set_select_val`  boolean Tehdäänkö enemmän kuin vain ladataan ylätunnisteet: merkitäänkäö jokin tunniste valituksi

## PickHeader

Lataa näytettäväksi käyttäjän valitseman ylätunnisteen.
Jos käyttäjä syöttänyt kokonaan uuden, lisätään se ylätunnisteiden listaan.

### Parameters

-   `selected_item`  valittu elementti (jquery ui-oliona)

## AddImageLoader

Listaa tietokantaan tallennettujen kuvien nimet

## CreateListOfImages

Prosessoi ladattujen kuvannimien listan ja luo siitä
select-elementin

### Parameters

-   `data`  dian tiedot ajax-responssina \*

## InitializeInjectableData

Hakee tiedot datasta, jota messun dioihin voi syöttää, kuten juontajan nimen tms.
Data tallennetaan valmiina jquery-elementteinä (select).

## InsertInjectableData

Lisää listan syötettävistä dataelementeistä niihin diaelementteihin, joissa sitä voidaan hyödyntää.

### Parameters

-   `$select`  syötettävä jquery-muotoinen select-elementtiä kuvaava olio

## ShowWindow

Näytä ikkuna, jossa käyttäjä voi muokata messun rakenteeseen lisättävää diaa

## SetLightBox

Nollaa lisäysvalikon sisältö ja syöttää uuden sisällön

### Parameters

-   `$el`  
-   `object`  $el jquery-olio, joka syötetään  lightbox-ikkunan sisään

## CloseLightBox

Sulkee lisäysvalikkoikkunan

## SetPreviewWindow

Nollaa esikatseluikkunan sisällön ja syöttää uuden.

### Parameters

-   `$el`  

## PreviewSlide

Avaa ikkuna, jossa voi esikatsella diaa.

## SetPreviewContent

Kun esikatseluikkuna latautunut, päivitä sen sisältö.

## SortableList

Kokonaisuus, johon slottien (tms.)  järjestelyominaisuus voidaan
liittää. Jquery uI:n sortable olisi ollut kiva, muttei toimi mobiilissa
edes touch and punch -hackillä.

### Parameters

-   `$ul`  järjesteltäväksi tarkoitetun listan jquery-representaatio
-   `dd_params`  jqueri ui draggable + droppable -asetukset\*

### Initialize

Liittää messuslotteihin raahaamiseen liittyvät toiminnot

#### Parameters

-   `axis`  
-   `parameters`  mudossa {
       draggables: ".css_class",
       droppables: ".css_class",
       drop_callback: function_reference,
    }\*

### RefreshPseudoSlots

Päivitä (tai luo) varsinaisten slottien välissä olevat
 "pseudo-slotit", joita käytetään osoittamaan paikat, jonne
 raahattavan elementin voi tiputtaa/

\*

### AddDroppables

Initializes or refreshes the droppables

\*

### DragStart

Määrittelee, mitä tapahtuu, kun käyttäjä alkaa raahata jotakin
slottia

\*

#### Parameters

-   `event`  

### CleanUp

Poista raahauksen aikana lisätyt luokat, tekstit ym.

\*

#### Parameters

-   `event`  

### DragLeave

Määrittelee, mitä tapahtuu, kun raahattu
elementti poistuu slottien välisen alueen
päältä

#### Parameters

-   `event`  funktion käynnistänyt tapahtuma\*

### DragOver

Määrittelee, mitä tapahtuu, kun elementti
raahataan slottien välisen tilan ylle

#### Parameters

-   `event`  funktion käynnistänyt tapahtuma\*

### Drop

Määrittelee, mitä tapahtuu, kun käyttäjä on tiputtanut raahaamansa elementin kohteeseen.

#### Parameters

-   `event`  funktion käynnistänyt tapahtuma\*

## ReloadSlots

Lataa informaation messun rakenneosista

### Parameters

-   `data`  ajax-responssina tullut informaatio sloteista\*

## RemoveSlot

Poista jokin messun rakenneosa kokonaan

\*

## InitializeNewslotMenu

Alustaa uusia slotteja lisäävän jquery-ui-menun toiminnallisuuden

\*

## InitializeSlotFunctionality

Lisää toiminnallisuuden messuslotteihin

\*

## UpdateAdderEvents

Lisää kaikkiin messun segmentteihin muokkaus- ja poisto-ominaisuudet.
Lisäksi mahdollistaa segmenttien uudelleenjärjestelyn raahaamalla.

## SlotFactory

Factory-pattern eri välilehtiä edustavien olioiden luomiseksi

\*

### make

Tuottaa yhden välilehtiolion haluttua tyyppiä

#### Parameters

-   `slot_type`  luotavan slotin tyyppi \*
-   `$container`  

## loaderpath

Funktiot ja oliot, joilla muokataan ja näytetään sanoja.

## loaderpath

Erillinen katselunäkymä lauluille ja niiden sanoille

## AddMultisongsRow

Lisää uuden rivin laulujen listaan tai poistaa viimeisimmän rivin.

## CheckIfLyricsExist

Tarkkailee tekstikenttiä ja katsoo, onko tietokannassa laulua, jonka nimi vastaisi tekstikentän arvoa.

### Parameters

-   `event`  
-   `val`  

## LoadLyricsByTitle

Lataa sanat annetun otsikon perusteella

### Parameters

-   `title`  
-   `byid`  

## ShowLyricsWindow

Näyttää sanojen lisäysikkunan, kun käyttäjä klikkaa oikeanpuolimmaista taulukon
solua.

## EditLyrics

Muokkaa näytettyjä sanoja ja tallentaa muutokset.

## AddLyrics

Lisää sanat uuteen lauluun

### Parameters

-   `songtitle`  

## SaveLyrics

Lähettää ajax-kyselynä sanat palvelimelle

## CloseWordEdit

Sulkee sanojen hallintaikkunan

## SongListView

Laululistanäkymä

\*

## ready

Interaktio ja layout-muokkaus laululistasivulle.

## ScrollToCenter

Skrollaa jokin elementti keskelle ruutua

### Parameters

-   `$el`  
-   `object`  $el jquery-olio, joka halutaan keskelle

## BlurContent

Sumenna tausta esim. kelluvan valikon alta

## extend

Periytymisen järjestämistä helpottava funktio.
<https://stackoverflow.com/questions/4152931/javascript-inheritance-call-super-constructor-or-use-prototype-chain>

### Parameters

-   `base`  
-   `sub`  
-   `function`  base olio, joka peritään
-   `function`  sub olio, joka perii

## Preview

Luo esikatselukuvan esimerkiksi taustakuvalle tai muulle ulkoasussa muokatttavalle elementille.

### Parameters

-   `$div`  
-   `filename`  
-   `object`  $div elementti, jonka sisällä esikatselu toteutetaan
-   `string`  filename, tarkasteltavan elementin tiedostonimi

## Message

Olio lyhyiden viestien näyttämiseen hallintanäytöllä.

### Parameters

-   `msg`  näytettävä viesti
-   `$parent_el`  jquery-elementti, jonka sisään viesti syötetään

### Show

Näyttää viestilaatikon viesti käyttäjälle

#### Parameters

-   `offtime`  millisekunteina se, kuinka kauan viesti näkyy (oletus 2 s)
